<dialog
        id="dialog-modal-example"
        x-data="modal"
        x-init="init($el)"
        class="max-w-md rounded-md shadow-2xl backdrop:bg-black/50 p-0 border-0"
        @click="close($event)"
        aria-labelledby="modal-title"
        aria-describedby="modal-description"
>
    <form action="" class="p-6 space-y-4">
        <h1 id="modal-title" class="text-2xl font-bold text-gray-900 m-0">{{ settings.modal_title }}</h1>
        <p id="modal-description" class="text-base text-gray-700 m-0">{{ settings.modal_description }}</p>
        <button type="button" @click="open = false" class="bg-gray-900 text-white px-6 py-3 font-medium hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors w-full" aria-label="Close dialog">
            Close
        </button>
    </form>
</dialog>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('modal', () => ({
            componentElement: document.querySelector('#dialog-modal-example'),
            open: false,
            init(dialog) {
                if (!dialog) {
                    return
                }

                Alpine.effect(() => {
                    if (this.open) {
                        dialog.showModal()
                        document.querySelectorAll('body > *:not(#shopify-section-modal)').forEach((element) => {
                            element.setAttribute('aria-hidden', 'true')
                            element.setAttribute('inert', '')
                        })
                        document.querySelector('body').classList.add('overflow-hidden')
                    } else {
                        dialog.close()
                        document.querySelectorAll('body > *:not(#shopify-section-modal)').forEach((element) => {
                            element.removeAttribute('aria-hidden')
                            element.removeAttribute('inert')
                        })
                        document.querySelector('body').classList.remove('overflow-hidden')
                    }
                })

                document.addEventListener('show-modal', () => {
                    this.open = true
                })

                document.addEventListener('close-modal', () => {
                    this.open = false
                })
            },
            toggle() {
                this.open = !this.open
            },
            close(event) {
                if (event.target === this.componentElement) {
                    if (this.open) {
                        this.open = false
                    }
                }
            }
        }))
    })
</script>
