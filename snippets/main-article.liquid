{%- comment -%}
  Main Article Page
  Displays full article content with metadata, sharing, and related articles
{%- endcomment -%}

{%- liquid
  # Extract settings
  assign featured_image_size = section.settings.featured_image_size | default: 'large'
  assign show_featured_image = section.settings.show_featured_image | default: true
  assign show_date = section.settings.show_date | default: true
  assign show_author = section.settings.show_author | default: true
  assign show_tags = section.settings.show_tags | default: true
  assign content_width = section.settings.content_width | default: 'narrow'
  assign show_social_sharing = section.settings.show_social_sharing | default: true
  assign social_sharing_title = section.settings.social_sharing_title | default: 'Share this article'
  assign show_related_articles = section.settings.show_related_articles | default: true
  assign related_articles_heading = section.settings.related_articles_heading | default: 'You might also like'
  assign related_articles_count = section.settings.related_articles_count | default: 3
  assign related_articles_source = section.settings.related_articles_source | default: 'same-tags'
  assign show_prev_next = section.settings.show_prev_next | default: true

  # Determine content width classes
  case content_width
    when 'narrow'
      assign content_width_classes = 'max-w-3xl'
    when 'medium'
      assign content_width_classes = 'max-w-5xl'
    when 'wide'
      assign content_width_classes = 'max-w-7xl'
  endcase

  # Determine featured image container classes
  case featured_image_size
    when 'small'
      assign image_container_classes = 'max-w-3xl mx-auto'
    when 'medium'
      assign image_container_classes = 'max-w-5xl mx-auto'
    when 'large'
      assign image_container_classes = 'max-w-7xl mx-auto'
    when 'hero'
      assign image_container_classes = 'w-full'
  endcase
-%}

<article class="px-6 md:px-8 py-12" role="article" aria-labelledby="article-title">
  <div class="container mx-auto">
    {%- # Breadcrumbs -%}
    {% render 'breadcrumbs' %}

    {%- # Article Header -%}
    <header class="{{ content_width_classes }} mx-auto mb-8">
      <div class="space-y-4">
        {%- if show_tags and article.tags.size > 0 -%}
          <div class="flex flex-wrap gap-2" role="list" aria-label="Article tags">
            {%- for tag in article.tags limit: 5 -%}
              <a href="{{ article.blog.url }}/tagged/{{ tag | handle }}" class="inline-block" role="listitem">
                {% render 'badge', text: tag, variant: 'info', size: 'small' %}
              </a>
            {%- endfor -%}
          </div>
        {%- endif -%}

        <h1 id="article-title" class="text-4xl lg:text-5xl font-bold text-gray-900">
          {{ article.title }}
        </h1>

        {%- if article.excerpt != blank -%}
          <p class="text-xl text-gray-600 leading-relaxed">
            {{ article.excerpt | strip_html }}
          </p>
        {%- endif -%}

        <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500 pt-4 border-t border-gray-200">
          {%- if show_author and article.author -%}
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
              <span aria-label="Author">{{ article.author }}</span>
            </div>
          {%- endif -%}

          {%- if show_date -%}
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <time datetime="{{ article.published_at | date: '%Y-%m-%d' }}" aria-label="Published date">
                {{ article.published_at | date: '%B %d, %Y' }}
              </time>
            </div>
          {%- endif -%}

          {%- if article.comments_count > 0 and blog.comments_enabled? -%}
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
              </svg>
              <a href="#comments" class="hover:text-blue-500 transition-colors">
                {{ article.comments_count }} {% if article.comments_count == 1 %}comment{% else %}comments{% endif %}
              </a>
            </div>
          {%- endif -%}
        </div>
      </div>
    </header>

    {%- # Featured Image -%}
    {%- if show_featured_image and article.image -%}
      <div class="{{ image_container_classes }} mb-12">
        <div class="aspect-w-16 aspect-h-9 bg-gray-100 overflow-hidden rounded-lg">
          <img
            src="{{ article.image | image_url: width: 1600 }}"
            alt="{{ article.image.alt | default: article.title }}"
            class="w-full h-full object-cover"
          >
        </div>
        {%- if article.image.alt -%}
          <p class="text-sm text-gray-500 mt-2 text-center italic">{{ article.image.alt }}</p>
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- # Article Content -%}
    <div class="{{ content_width_classes }} mx-auto">
      <div class="prose prose-gray max-w-none prose-headings:font-bold prose-h2:text-3xl prose-h3:text-2xl prose-h4:text-xl prose-p:text-gray-700 prose-p:leading-relaxed prose-a:text-blue-500 prose-a:no-underline hover:prose-a:underline prose-img:rounded-lg prose-blockquote:border-l-4 prose-blockquote:border-blue-500 prose-blockquote:pl-4 prose-blockquote:italic" role="main" aria-label="Article content">
        {{ article.content }}
      </div>

      {%- # Social Sharing -%}
      {%- if show_social_sharing -%}
        <div class="mt-12 pt-8 border-t border-gray-200">
          {% render 'article-social-share',
            article: article,
            title: social_sharing_title
          %}
        </div>
      {%- endif -%}
    </div>

    {%- # Previous/Next Navigation -%}
    {%- if show_prev_next -%}
      <div class="max-w-7xl mx-auto mt-16 pt-8 border-t border-gray-200">
        {% render 'article-navigation',
          blog: article.blog,
          current_article: article
        %}
      </div>
    {%- endif -%}

    {%- # Related Articles -%}
    {%- if show_related_articles -%}
      <div class="max-w-7xl mx-auto mt-16">
        {% render 'article-related',
          article: article,
          heading: related_articles_heading,
          count: related_articles_count,
          source: related_articles_source
        %}
      </div>
    {%- endif -%}

    {%- # Comments -%}
    {%- if blog.comments_enabled? -%}
      <div class="{{ content_width_classes }} mx-auto mt-16" id="comments">
        <h2 class="text-3xl font-bold text-gray-900 mb-8">Comments</h2>
        {% render 'article-comments', article: article %}
      </div>
    {%- endif -%}
  </div>
</article>
