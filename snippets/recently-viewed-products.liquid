{%- if section.settings.enable_recently_viewed -%}
  <div class="px-6 md:px-8 py-12 md:py-16 bg-white">
    <div class="container mx-auto"
         x-data="recentlyViewedSection"
         data-current-product-id="{{ product.id | default: '' }}"
         data-limit="{{ section.settings.products_to_show | default: 4 }}"
         data-exclude-current="{{ section.settings.exclude_current_product | default: true }}"
         data-money-format="{{ shop.money_format | json | escape }}"
         data-product="{{ product | json | escape }}"
         x-init="init()">

      {%- comment -%} Heading {%- endcomment -%}
      {% if section.settings.heading != blank %}
        <h2 class="mb-8
          {% if section.settings.heading_size == 'small' %}text-2xl{% elsif section.settings.heading_size == 'large' %}text-4xl{% else %}text-3xl{% endif %}
          font-bold
          {% if section.settings.text_alignment == 'center' %}text-center{% elsif section.settings.text_alignment == 'right' %}text-right{% else %}text-left{% endif %}">
          {{ section.settings.heading }}
        </h2>
      {% endif %}

      {%- comment -%} Products Grid {%- endcomment -%}
      <div x-show="displayProducts.length > 0"
           x-cloak
           class="grid grid-cols-1 sm:grid-cols-2
             {% if section.settings.columns_desktop == 2 %}lg:grid-cols-2
             {% elsif section.settings.columns_desktop == 3 %}lg:grid-cols-3
             {% elsif section.settings.columns_desktop == 5 %}lg:grid-cols-5
             {% else %}lg:grid-cols-4{% endif %}
             gap-6"
           x-ref="productsGrid">
        {%- comment -%} Products will be injected here via Alpine.js {%- endcomment -%}
      </div>

      {%- comment -%} Empty State {%- endcomment -%}
      <div x-show="displayProducts.length === 0"
           x-cloak
           class="text-center py-8 text-gray-600">
        <p>No recently viewed products.</p>
      </div>
    </div>
  </div>
{%- endif -%}
