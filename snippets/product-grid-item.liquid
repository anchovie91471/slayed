{% comment %}
  Usage:
  {% render 'product-grid-item',
    product: {product object},
    is_first: {boolean} (optional) - Adds fetchpriority="high" for LCP optimization
  %}
{% endcomment %}

<div class="product-grid-item relative group border border-gray-200 p-4">
    <div class="block image-wrapper relative pt-[140%] overflow-hidden bg-gray-100 mb-4">
        {% if is_first %}
            {{ prod.featured_image | image_url: width: 410 | image_tag:
                class: "absolute inset-0 object-cover h-full w-full group-hover:opacity-75 transition-opacity duration-150",
                widths: "205,410",
                loading: "eager",
                fetchpriority: "high" }}
        {% else %}
            {{ prod.featured_image | image_url: width: 410 | image_tag:
                class: "absolute inset-0 object-cover h-full w-full group-hover:opacity-75 transition-opacity duration-150",
                widths: "205,410",
                loading: "lazy" }}
        {% endif %}

        {%- comment -%} Quick View Button {%- endcomment -%}
        {% if enable_quick_view %}
            <button type="button"
                    @click="$dispatch('open-quick-view', { productHandle: '{{ prod.handle }}', settings: {{ quick_view_settings | json }} })"
                    class="absolute bottom-4 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity bg-white text-gray-900 px-4 py-2 text-sm font-medium hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-400 z-10"
                    aria-label="Quick view {{ prod.title }}">
                Quick View
            </button>
        {% endif %}
    </div>
    <div class="content space-y-2">
        <a href="{{ prod.url }}" class="after:content-[''] after:inset-0 after:absolute focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-inset">
            <h3 class="text-sm font-medium text-gray-900 group-hover:text-blue-500 transition-colors">
                {{ prod.title }}
            </h3>
        </a>
        <div class="flex flex-wrap items-center gap-2">
            {% if prod.price_varies %}
                <span class="text-sm text-gray-600">
            From
          </span>
            {% endif %}
            <span class="text-sm text-gray-900 font-medium">
          {{ prod.price | money_with_currency }}
        </span>
            {% if prod.compare_at_price_max != blank and prod.compare_at_price_max > prod.price %}
                <span class="text-sm text-gray-500 line-through">{{ prod.compare_at_price_max | money_with_currency }}</span>
                <span class="inline-block px-2 py-1 text-xs font-medium bg-red-100 text-red-800">Sale</span>
            {% endif %}
        </div>
    </div>
    {% comment %}
      {% form 'product', prod %}
        <input type="hidden" name="id" value="{{ prod.selected_or_first_available_variant.id }}">
        <input type="hidden" name="quantity" value="1">
        <input type="submit" value="Add to cart">
        <div data-ajax-cart-messages="form">
          <!-- Error messages appear here -->
        </div>
        </button>
      {% endform %}
    {% endcomment %}
</div>
